from MachineLearningModule import MachineLearningFlow
from FeatureExtractionModule import FeatureExtraction
from Util import Util
import logging

# Conguration loggging
logging.basicConfig(level = logging.INFO, format = '%(asctime)s - %(name)s - %(levelname)s - %(message)s')

def main():
    # Path to the dataset's CSV file
    dataset_path = "Datasets/Drebin_v1.csv"

    # Classifiers (RF | SVM | KNN | NB | MLP)
    ml_algorithm = "KNN"

    # Path to the APK file
    apk_path = "./apkfile/com.microsoft.bing_30.1.421216001-421216001_minAPI26(armeabi-v7a)(nodpi)_apkmirror.com.apk"

    logging.info("Starting machine learning flow")
    # Machine learning module
    classifier, most_relevant_features, evaluation_metrics = MachineLearningFlow.machine_learning_flow(dataset_path, ml_algorithm)
    logging.info("Machine learning flow completed")

    logging.info("Starting feature extraction")
    # Feature extraction module
    extracted_features = FeatureExtraction.feature_extraction(apk_path, most_relevant_features)
    logging.info("Feature extraction completed")
    
    # Prediction
    print("\nPrediction:", classifier.predict(extracted_features))
    prediction = classifier.predict(extracted_features)
    logging.info(f"Prediction: {prediction}")


    # Printing the evaluation metrics
    Util.print_evaluation_metrics(evaluation_metrics)


if __name__ == '__main__':
    main()
